{"id":"9B1j","dependencies":[{"name":"@babel/runtime-corejs2/helpers/interopRequireWildcard","loc":{"line":3,"column":38},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/interopRequireWildcard.js"},{"name":"@babel/runtime-corejs2/helpers/interopRequireDefault","loc":{"line":5,"column":37},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/interopRequireDefault.js"},{"name":"@babel/runtime-corejs2/helpers/classCallCheck","loc":{"line":12,"column":54},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/classCallCheck.js"},{"name":"@babel/runtime-corejs2/helpers/possibleConstructorReturn","loc":{"line":14,"column":65},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/possibleConstructorReturn.js"},{"name":"@babel/runtime-corejs2/helpers/getPrototypeOf","loc":{"line":16,"column":54},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/getPrototypeOf.js"},{"name":"@babel/runtime-corejs2/helpers/createClass","loc":{"line":18,"column":51},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/createClass.js"},{"name":"@babel/runtime-corejs2/helpers/inherits","loc":{"line":20,"column":48},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/inherits.js"},{"name":"@babel/runtime-corejs2/helpers/assertThisInitialized","loc":{"line":22,"column":61},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/assertThisInitialized.js"},{"name":"@babel/runtime-corejs2/helpers/defineProperty","loc":{"line":24,"column":54},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/defineProperty.js"},{"name":"@babel/runtime-corejs2/helpers/toConsumableArray","loc":{"line":26,"column":57},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/helpers/toConsumableArray.js"},{"name":"@babel/runtime-corejs2/core-js/set","loc":{"line":28,"column":42},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/node_modules/@babel/runtime-corejs2/core-js/set.js"},{"name":"react","loc":{"line":30,"column":45},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/react/index.js"},{"name":"./utils","loc":{"line":32,"column":21},"parent":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/side-effect.js","resolved":"/Users/thanatos/projects/memory/node_modules/next-server/dist/lib/utils.js"}],"generated":{"js":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime-corejs2/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = withSideEffect;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/classCallCheck\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/inherits\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/assertThisInitialized\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/defineProperty\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/toConsumableArray\"));\n\nvar _set = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/set\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _utils = require(\"./utils\");\n\nfunction withSideEffect(reduceComponentsToState, handleStateChangeOnClient, mapStateOnServer) {\n  if (typeof reduceComponentsToState !== 'function') {\n    throw new Error('Expected reduceComponentsToState to be a function.');\n  }\n\n  if (typeof handleStateChangeOnClient !== 'function') {\n    throw new Error('Expected handleStateChangeOnClient to be a function.');\n  }\n\n  if (typeof mapStateOnServer !== 'undefined' && typeof mapStateOnServer !== 'function') {\n    throw new Error('Expected mapStateOnServer to either be undefined or a function.');\n  }\n\n  return function wrap(WrappedComponent) {\n    if (typeof WrappedComponent !== 'function') {\n      throw new Error('Expected WrappedComponent to be a React component.');\n    }\n\n    var mountedInstances = new _set.default();\n    var state;\n\n    function emitChange(component) {\n      state = reduceComponentsToState((0, _toConsumableArray2.default)(mountedInstances));\n\n      if (SideEffect.canUseDOM) {\n        handleStateChangeOnClient.call(component, state);\n      } else if (mapStateOnServer) {\n        state = mapStateOnServer(state);\n      }\n    }\n\n    var SideEffect =\n    /*#__PURE__*/\n    function (_Component) {\n      (0, _inherits2.default)(SideEffect, _Component);\n      (0, _createClass2.default)(SideEffect, null, [{\n        key: \"peek\",\n        // Expose canUseDOM so tests can monkeypatch it\n        // Try to use displayName of wrapped component\n        value: function peek() {\n          return state;\n        }\n      }, {\n        key: \"rewind\",\n        value: function rewind() {\n          if (SideEffect.canUseDOM) {\n            throw new Error('You may only call rewind() on the server. Call peek() to read the current state.');\n          }\n\n          var recordedState = state;\n          state = undefined;\n          mountedInstances.clear();\n          return recordedState;\n        }\n      }]);\n\n      function SideEffect(props) {\n        var _this;\n\n        (0, _classCallCheck2.default)(this, SideEffect);\n        _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(SideEffect).call(this, props));\n\n        if (!SideEffect.canUseDOM) {\n          mountedInstances.add((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)));\n          emitChange((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)));\n        }\n\n        return _this;\n      }\n\n      (0, _createClass2.default)(SideEffect, [{\n        key: \"componentDidMount\",\n        value: function componentDidMount() {\n          mountedInstances.add(this);\n          emitChange(this);\n        }\n      }, {\n        key: \"componentDidUpdate\",\n        value: function componentDidUpdate() {\n          emitChange(this);\n        }\n      }, {\n        key: \"componentWillUnmount\",\n        value: function componentWillUnmount() {\n          mountedInstances.delete(this);\n          emitChange(this);\n        }\n      }, {\n        key: \"render\",\n        value: function render() {\n          return _react.default.createElement(WrappedComponent, null, this.props.children);\n        }\n      }]);\n      return SideEffect;\n    }(_react.Component);\n\n    (0, _defineProperty2.default)(SideEffect, \"canUseDOM\", typeof window !== 'undefined');\n    (0, _defineProperty2.default)(SideEffect, \"contextTypes\", WrappedComponent.contextTypes);\n    (0, _defineProperty2.default)(SideEffect, \"displayName\", \"SideEffect(\".concat((0, _utils.getDisplayName)(WrappedComponent), \")\"));\n    return SideEffect;\n  };\n}","map":null},"hash":"3f860fb5cbc923b39f7034ae8592ec58","cacheData":{"env":{}}}